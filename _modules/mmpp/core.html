

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mmpp.core &mdash; MMPP 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MMPP
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MMPP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">mmpp.core</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mmpp.core</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.syntax</span><span class="w"> </span><span class="kn">import</span> <span class="n">Syntax</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.console</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zarr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyzfn</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pyzfn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.logging_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_mmpp_logging</span><span class="p">,</span> <span class="n">get_mmpp_logger</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NDArray</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.batch_operations</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchOperations</span>

<span class="c1"># Initialize rich logging - will be configured in MMPP.__init__</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">get_mmpp_logger</span><span class="p">(</span><span class="s2">&quot;mmpp&quot;</span><span class="p">)</span>

<span class="c1"># Type aliases for numpy arrays</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="n">npf32</span> <span class="o">=</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
    <span class="n">npc64</span> <span class="o">=</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">]</span>
    <span class="n">np1d</span> <span class="o">=</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">np2d</span> <span class="o">=</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">np3d</span> <span class="o">=</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">np4d</span> <span class="o">=</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">np5d</span> <span class="o">=</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">np4dc</span> <span class="o">=</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">npf32</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">npc64</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">np1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">np2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">np3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">np4d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">np5d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">np4dc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="n">ArraySlice</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">slice</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>

<span class="c1"># Import for interactive display</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">itables</span><span class="w"> </span><span class="kn">import</span> <span class="n">show</span><span class="p">,</span> <span class="n">init_notebook_mode</span>

    <span class="n">ITABLES_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ITABLES_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rich.console</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rich.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rich.syntax</span><span class="w"> </span><span class="kn">import</span> <span class="n">Syntax</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rich.panel</span><span class="w"> </span><span class="kn">import</span> <span class="n">Panel</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rich.columns</span><span class="w"> </span><span class="kn">import</span> <span class="n">Columns</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rich.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">Text</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rich</span><span class="w"> </span><span class="kn">import</span> <span class="nb">print</span> <span class="k">as</span> <span class="n">rprint</span>

    <span class="n">RICH_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">RICH_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="n">IPYTHON_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">IPYTHON_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Import plotting functionality</span>
<span class="n">PLOTTING_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">MMPPlotter</span><span class="p">,</span> <span class="n">PlotterProxy</span>


<span class="c1"># Import FFT functionality</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.fft</span><span class="w"> </span><span class="kn">import</span> <span class="n">FFT</span>

    <span class="n">FFT_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">FFT_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>


<div class="viewcode-block" id="ScanResult">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ScanResult">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ScanResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data class for storing scan results from a single zarr folder.&quot;&quot;&quot;</span>

    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="ZarrJobResult">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ZarrJobResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enhanced zarr job result with integrated Pyzfn functionality.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ZarrJobResult.__init__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize ZarrJobResult with path and attributes.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Path to the zarr folder</span>
<span class="sd">        attributes : Dict[str, Any]</span>
<span class="sd">            Metadata attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mmpp_ref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_zarr_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Lazy load zarr group when needed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path Not Found : &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path is not a zarr group : &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">z</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path_obj</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_obj</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">z</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Group</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the zarr group (lazy loaded).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_zarr_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the name of the zarr folder.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path_obj</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_obj</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">script</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Syntax</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if there&#39;s a .mx3* file in the parent directory with the same name as the zarr simulation.</span>
<span class="sd">        If found, return syntax-highlighted content using rich.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[Syntax]: Syntax-highlighted script or None if no file found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Debug marker reached&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># Get the zarr path and name</span>
            <span class="n">zarr_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>

            <span class="c1"># Get zarr filename without extension</span>
            <span class="n">zarr_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">zarr_path</span><span class="p">)</span>
            <span class="n">base_name</span> <span class="o">=</span> <span class="n">zarr_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.zarr&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># Go to parent directory</span>
            <span class="n">parent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zarr_path</span><span class="p">)</span>

            <span class="c1"># Search for .mx3* file with the same name</span>
            <span class="n">mx3_pattern</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">.mx3*&quot;</span><span class="p">)</span>
            <span class="n">mx3_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">mx3_pattern</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">mx3_files</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No .mx3 file found for simulation </span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># Take the first matching file</span>
            <span class="n">mx3_file</span> <span class="o">=</span> <span class="n">mx3_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Read file content</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mx3_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">mx3_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="c1"># Create syntax-highlighted script</span>
            <span class="n">syntax</span> <span class="o">=</span> <span class="n">Syntax</span><span class="p">(</span><span class="n">mx3_content</span><span class="p">,</span> <span class="s2">&quot;go&quot;</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s2">&quot;monokai&quot;</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">syntax</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while retrieving script: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="ZarrJobResult.display_script">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.display_script">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">display_script</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display syntax-highlighted .mx3 script in console.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">script</span>
        <span class="k">if</span> <span class="n">script</span><span class="p">:</span>
            <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No script found to display.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZarrJobResult.__getitem__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.__getitem__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">zarr</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Group</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get zarr dataset or group by key.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_zarr_loaded</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">: The dataset `</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">` does not exist.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZarrJobResult.__setitem__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.__setitem__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set zarr dataset or attribute.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_zarr_loaded</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="ZarrJobResult.__getattr__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.__getattr__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">zarr</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Group</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get zarr attribute or dataset by name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;attributes&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_zarr_loaded</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">: The dataset `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` does not exist.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZarrJobResult.__repr__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.__repr__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ZarrJobResult(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;)&quot;</span></div>


<div class="viewcode-block" id="ZarrJobResult.__str__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.__str__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ZarrJobResult(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;)&quot;</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pretty print the zarr tree.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_zarr_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">tree</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">p</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the zarr tree.&quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, Structure: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">tree</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ZarrJobResult.rm">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.rm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a group or dataset.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        dset : str</span>
<span class="sd">            Name of dataset or group to remove</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZarrJobResult.is_finished">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.is_finished">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if simulation is finished.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_zarr_loaded</span><span class="p">()</span>
        <span class="n">end_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">end_time</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="ZarrJobResult.is_running">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.is_running">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_running</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if simulation is still running.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_finished</span><span class="p">()</span></div>


<div class="viewcode-block" id="ZarrJobResult.mkdir">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.mkdir">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create nested directories.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Directory path to create</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_raw">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_raw">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_raw</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">zarr</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get raw zarr dataset or data using direct indexing.</span>
<span class="sd">        Handles datasets with special characters (like minus) in names.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        dset : str</span>
<span class="sd">            Dataset name (can contain special characters)</span>
<span class="sd">        slices : ArraySlice, optional</span>
<span class="sd">            Array slicing specification (default: all data)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        Union[zarr.Array, np.ndarray]</span>
<span class="sd">            Raw zarr dataset or numpy array if sliced</span>

<span class="sd">        Example:</span>
<span class="sd">        --------</span>
<span class="sd">        # For dataset names with special characters like &quot;m_z5-8&quot;</span>
<span class="sd">        data = result.get_raw(&quot;m_z5-8&quot;)[:]</span>
<span class="sd">        # or with slicing</span>
<span class="sd">        data = result.get_raw(&quot;m_z5-8&quot;, slice(0, 100))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_zarr_loaded</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Direct access using zarr indexing</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">[</span><span class="n">dset</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">slices</span> <span class="o">==</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">dataset</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dataset</span><span class="p">[</span><span class="n">slices</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">: The dataset `</span><span class="si">{</span><span class="n">dset</span><span class="si">}</span><span class="s2">` does not exist.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_raw_data">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_raw_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_raw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get raw data as numpy array from dataset with special characters.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        dset : str</span>
<span class="sd">            Dataset name (can contain special characters)</span>
<span class="sd">        slices : ArraySlice, optional</span>
<span class="sd">            Array slicing specification (default: all data)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Numpy array with original dtype</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raw</span><span class="p">(</span><span class="n">dset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">slices</span><span class="p">])</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_raw_f32">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_raw_f32">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_raw_f32</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get raw data as float32 array from dataset with special characters.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        dset : str</span>
<span class="sd">            Dataset name (can contain special characters)</span>
<span class="sd">        slices : ArraySlice, optional</span>
<span class="sd">            Array slicing specification (default: all data)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        npf32</span>
<span class="sd">            Float32 numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_raw</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">slices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_raw_c64">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_raw_c64">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_raw_c64</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">npc64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get raw data as complex64 array from dataset with special characters.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        dset : str</span>
<span class="sd">            Dataset name (can contain special characters)</span>
<span class="sd">        slices : ArraySlice, optional</span>
<span class="sd">            Array slicing specification (default: all data)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        npc64</span>
<span class="sd">            Complex64 numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_raw</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">slices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZarrJobResult.list_datasets">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.list_datasets">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all available datasets in the zarr group.</span>
<span class="sd">        Useful for finding datasets with special characters.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        List[str]</span>
<span class="sd">            List of dataset names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_zarr_loaded</span><span class="p">()</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">collect_datasets</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">full_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">prefix</span> <span class="k">else</span> <span class="n">key</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
                    <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_key</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                    <span class="n">collect_datasets</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">full_key</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>

        <span class="n">collect_datasets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">datasets</span></div>


<div class="viewcode-block" id="ZarrJobResult.find_datasets">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.find_datasets">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find datasets matching a pattern (supports wildcards).</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        pattern : str</span>
<span class="sd">            Pattern to match (supports * and ? wildcards)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        List[str]</span>
<span class="sd">            List of matching dataset names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">fnmatch</span>

        <span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_datasets</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">dset</span> <span class="k">for</span> <span class="n">dset</span> <span class="ow">in</span> <span class="n">datasets</span> <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)]</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_dset">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_dset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_dset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get zarr dataset.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        dset : str</span>
<span class="sd">            Dataset name</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        zarr.Array</span>
<span class="sd">            The zarr dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dset_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">dset</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dset_tmp</span><span class="p">,</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">dset</span><span class="si">}</span><span class="s2">` is a group, not a dataset.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dset_tmp</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_f32">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_f32">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_f32</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npf32</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get float32 array from dataset.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        dset : str</span>
<span class="sd">            Dataset name</span>
<span class="sd">        slices : ArraySlice</span>
<span class="sd">            Array slicing specification</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        npf32</span>
<span class="sd">            Float32 numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_dset</span><span class="p">(</span><span class="n">dset</span><span class="p">)[</span><span class="n">slices</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_c64">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_c64">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_c64</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npc64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get complex64 array from dataset.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        dset : str</span>
<span class="sd">            Dataset name</span>
<span class="sd">        slices : ArraySlice</span>
<span class="sd">            Array slicing specification</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        npc64</span>
<span class="sd">            Complex64 numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_dset</span><span class="p">(</span><span class="n">dset</span><span class="p">)[</span><span class="n">slices</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_np1d">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_np1d">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_np1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np1d</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get 1D numpy array from dataset.&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_f32</span><span class="p">(</span><span class="n">dset_str</span><span class="p">,</span> <span class="n">slices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dataset must be 1D&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arr</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_np2d">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_np2d">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_np2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np2d</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get 2D numpy array from dataset.&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_f32</span><span class="p">(</span><span class="n">dset_str</span><span class="p">,</span> <span class="n">slices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dataset must be 2D&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arr</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_np3d">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_np3d">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_np3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np3d</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get 3D numpy array from dataset.&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_f32</span><span class="p">(</span><span class="n">dset_str</span><span class="p">,</span> <span class="n">slices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dataset must be 3D&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arr</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_np4d">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_np4d">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_np4d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np4d</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get 4D numpy array from dataset.&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_f32</span><span class="p">(</span><span class="n">dset_str</span><span class="p">,</span> <span class="n">slices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dataset must be 4D&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arr</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_np5d">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_np5d">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_np5d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np5d</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get 5D numpy array from dataset.&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_f32</span><span class="p">(</span><span class="n">dset_str</span><span class="p">,</span> <span class="n">slices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dataset must be 5D&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arr</span></div>


<div class="viewcode-block" id="ZarrJobResult.get_np4dc">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.get_np4dc">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_np4dc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slices</span><span class="p">:</span> <span class="n">ArraySlice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np4dc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get 4D complex array from modes dataset.&quot;&quot;&quot;</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;modes/</span><span class="si">{</span><span class="n">dset_str</span><span class="si">}</span><span class="s2">/arr&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="n">slices</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_mmpp_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mmpp_instance</span><span class="p">:</span> <span class="s2">&quot;MMPP&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set reference to MMPP instance for plotting.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mmpp_ref</span> <span class="o">=</span> <span class="n">mmpp_instance</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mpl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MMPPlotter&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MMPPlotter</span><span class="p">([</span><span class="bp">self</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmpp_ref</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">matplotlib</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MMPPlotter&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get matplotlib plotter for this single result (alias for mpl).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpl</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fft</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FFT&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get FFT analyzer for this single result.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">FFT_AVAILABLE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;FFT functionality not available. Check fft module import.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmpp_ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MMPP reference not set. Use results from MMPP instance.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FFT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmpp_ref</span><span class="p">)</span>

<div class="viewcode-block" id="ZarrJobResult.calculate_fft_data">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.ZarrJobResult.calculate_fft_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_fft_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Direct method for FFT calculation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">_compute_fft</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="MMPP">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MMPP</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multi-threaded scanner for zarr folders with pandas database creation and search functionality.</span>

<span class="sd">    This class scans directories recursively for .zarr folders, extracts metadata using Pyzfn,</span>
<span class="sd">    and creates a searchable pandas database.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MMPP.__init__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">base_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
        <span class="n">database_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mmpy_database&quot;</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the MMPP.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        base_path : str</span>
<span class="sd">            Base directory path to scan for zarr folders OR direct path to .zarr file</span>
<span class="sd">        max_workers : int, optional</span>
<span class="sd">            Maximum number of worker threads for scanning (default: 8)</span>
<span class="sd">        database_name : str, optional</span>
<span class="sd">            Name of the database file (without extension, default: &quot;mmpy_database&quot;)</span>
<span class="sd">        debug : bool, optional</span>
<span class="sd">            Enable debug logging (default: False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">max_workers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">database_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Enable interactive mode by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_single_zarr_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ZarrJobResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Configure rich logging for this instance</span>
        <span class="k">global</span> <span class="n">log</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">setup_mmpp_logging</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">logger_name</span><span class="o">=</span><span class="s2">&quot;mmpp&quot;</span><span class="p">)</span>

        <span class="c1"># Check if base_path is a direct .zarr file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zarr&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_single_zarr_mode</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_single_zarr</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Original directory scanning mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database_name</span><span class="si">}</span><span class="s2">.pkl&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Try to load existing database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_database</span><span class="p">()</span>

        <span class="c1"># Initialize rich console if available</span>
        <span class="k">if</span> <span class="n">RICH_AVAILABLE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_load_single_zarr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a single .zarr file directly.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Scan the single zarr file</span>
            <span class="n">scan_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_single_zarr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">scan_result</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error loading zarr file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">scan_result</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Create ZarrJobResult</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ZarrJobResult</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="n">scan_result</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">scan_result</span><span class="o">.</span><span class="n">attributes</span>
            <span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">_set_mmpp_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>

            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded single zarr file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading single zarr file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MMPP.__len__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.__len__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return number of zarr results available.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_zarr_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="MMPP.__getitem__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.__getitem__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ZarrJobResult</span><span class="p">,</span> <span class="s2">&quot;BatchOperations&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get zarr result by index or batch operations by slice.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        index : Union[int, slice]</span>
<span class="sd">            Index of the result to get or slice for batch operations</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        Union[ZarrJobResult, BatchOperations]</span>
<span class="sd">            Single zarr result for integer index or batch operations for slice</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle slice notation for batch operations</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="c1"># Import here to avoid circular imports</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">.batch_operations</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchOperations</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_zarr_mode</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Database mode</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;No database available. Run scan() first.&quot;</span><span class="p">)</span>

                <span class="c1"># Get slice of dataframe</span>
                <span class="n">df_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
                    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">col</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                        <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;path&quot;</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
                    <span class="p">}</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">ZarrJobResult</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">_set_mmpp_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">BatchOperations</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Handle integer index for single result</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Index must be int or slice, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_zarr_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> out of range for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Database mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;No database available. Run scan() first.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">):</span>
                <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
                <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">col</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;path&quot;</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
                <span class="p">}</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">ZarrJobResult</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">_set_mmpp_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> out of range for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s2"> results&quot;</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="MMPP.__iter__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.__iter__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make MMPP iterable.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mpl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MMPPlotter&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get matplotlib plotter for all results.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PLOTTING_AVAILABLE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;Plotting functionality not available. Check plotting.py import.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_zarr_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MMPPlotter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_jobs</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">MMPPlotter</span><span class="p">(</span><span class="n">all_results</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">matplotlib</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MMPPlotter&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get matplotlib plotter for all results (alias for mpl).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpl</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fft</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FFT&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get FFT analyzer for all results.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">FFT_AVAILABLE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;FFT functionality not available. Check fft module import.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># For single zarr mode, return FFT for the first result</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_zarr_mode</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FFT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For database mode, get first result or create empty FFT</span>
            <span class="n">all_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_jobs</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">all_results</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FFT</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No results available for FFT analysis&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_zarr_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively find all .zarr folders in the base path.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        List[str]</span>
<span class="sd">            List of paths to zarr folders</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zarr_folders</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">):</span>
            <span class="c1"># Check if current directory is a zarr folder</span>
            <span class="k">if</span> <span class="n">root</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zarr&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
                <span class="n">zarr_folders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                <span class="c1"># Don&#39;t descend into zarr folders</span>
                <span class="n">dirs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">zarr_folders</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_path_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zarr_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse parameters from the folder path structure, including zarr folder name.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        zarr_path : str</span>
<span class="sd">            Dictionary of parameters extracted from the path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get relative path from base_path to zarr folder</span>
            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">zarr_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span>

            <span class="c1"># Split the path into components</span>
            <span class="n">path_parts</span> <span class="o">=</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>

            <span class="c1"># Process all path components including the .zarr folder name</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">path_parts</span><span class="p">:</span>
                <span class="c1"># Skip empty parts and version folders (like &#39;v1&#39;)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span>
                <span class="p">):</span>
                    <span class="k">continue</span>

                <span class="c1"># If this is a .zarr folder, remove the .zarr extension for parsing</span>
                <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zarr&quot;</span><span class="p">):</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># Remove .zarr extension</span>

                <span class="c1"># Parse parameters from this path component</span>
                <span class="n">component_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_path_component</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                <span class="n">path_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">component_params</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing path parameters from </span><span class="si">{</span><span class="n">zarr_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">path_params</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_single_path_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse parameters from a single path component.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        component : str</span>
<span class="sd">            Single path component (folder name)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">            Dictionary of parameters extracted from this component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Handle comma-separated parameters in a single component</span>
            <span class="c1"># Example: &quot;param1_value1,param2_value2&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">component</span><span class="p">:</span>
                <span class="n">sub_parts</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">sub_part</span> <span class="ow">in</span> <span class="n">sub_parts</span><span class="p">:</span>
                    <span class="n">sub_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_path_component</span><span class="p">(</span><span class="n">sub_part</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sub_params</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">params</span>

            <span class="c1"># Pattern 1: parameter_values_number (e.g., f0_values_2.15e+09)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;^(.+)_values_([-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?)$&quot;</span><span class="p">,</span> <span class="n">component</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                <span class="k">return</span> <span class="n">params</span>

            <span class="c1"># Pattern 2: parameter_number (e.g., solver_3, maxerr_1e-06)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;^(.+?)_([-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?)$&quot;</span><span class="p">,</span> <span class="n">component</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Try to convert to float first</span>
                    <span class="n">float_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
                    <span class="c1"># If it&#39;s a whole number, convert to int</span>
                    <span class="k">if</span> <span class="n">float_value</span><span class="o">.</span><span class="n">is_integer</span><span class="p">():</span>
                        <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">float_value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">float_value</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                <span class="k">return</span> <span class="n">params</span>

            <span class="c1"># Pattern 3: Multiple underscore-separated parameters</span>
            <span class="c1"># Example: &quot;param1_val1_param2_val2&quot;</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Try to parse as alternating param_value pairs</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">):</span>
                        <span class="n">param_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">param_value_str</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Try to convert to number</span>
                            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">param_value_str</span> <span class="ow">or</span> <span class="s2">&quot;e&quot;</span> <span class="ow">in</span> <span class="n">param_value_str</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                <span class="n">param_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">param_value_str</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">param_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param_value_str</span><span class="p">)</span>
                            <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value_str</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">:</span>  <span class="c1"># If we successfully parsed something</span>
                    <span class="k">return</span> <span class="n">params</span>

            <span class="c1"># Pattern 4: Just parameter name without underscore (treat as boolean flag)</span>
            <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">component</span> <span class="ow">and</span> <span class="n">component</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
                <span class="n">params</span><span class="p">[</span><span class="n">component</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="n">params</span>

            <span class="c1"># Pattern 5: If nothing else matches but contains underscores,</span>
            <span class="c1"># treat as a complex parameter name</span>
            <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">component</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="n">component</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing component &#39;</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_scan_single_zarr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zarr_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScanResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scan a single zarr folder and extract metadata using Pyzfn.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        zarr_path : str</span>
<span class="sd">            Path to the zarr folder</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        ScanResult</span>
<span class="sd">            Result containing path, attributes, and potential error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Initialize Pyzfn job</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">Pyzfn</span><span class="p">(</span><span class="n">zarr_path</span><span class="p">)</span>

            <span class="c1"># Extract all attributes from Pyzfn</span>
            <span class="n">attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Convert numpy arrays to lists for pandas compatibility</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="s2">&quot;tolist&quot;</span><span class="p">):</span>
                    <span class="n">attributes</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attributes</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_value</span>

            <span class="c1"># Parse parameters from full path (including zarr folder name)</span>
            <span class="n">path_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_path_parameters</span><span class="p">(</span><span class="n">zarr_path</span><span class="p">)</span>

            <span class="c1"># Merge path parameters with Pyzfn attributes</span>
            <span class="c1"># Pyzfn attributes take precedence over path parameters</span>
            <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">path_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                    <span class="n">attributes</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If parameter exists in both, keep Pyzfn version but add path version with suffix</span>
                    <span class="n">attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>

            <span class="k">return</span> <span class="n">ScanResult</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">zarr_path</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ScanResult</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">zarr_path</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="p">{},</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_scan_all_zarr_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zarr_folders</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ScanResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scan all zarr folders using multiple threads.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        zarr_folders : List[str]</span>
<span class="sd">            List of zarr folder paths to scan</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        List[ScanResult]</span>
<span class="sd">            List of scan results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ScanResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Scanning </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">zarr_folders</span><span class="p">)</span><span class="si">}</span><span class="s2"> zarr folders using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span><span class="si">}</span><span class="s2"> threads...&quot;</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="c1"># Submit all tasks</span>
            <span class="n">future_to_path</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_single_zarr</span><span class="p">,</span> <span class="n">zarr_path</span><span class="p">):</span> <span class="n">zarr_path</span>
                <span class="k">for</span> <span class="n">zarr_path</span> <span class="ow">in</span> <span class="n">zarr_folders</span>
            <span class="p">}</span>

            <span class="c1"># Collect results as they complete</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">future</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_path</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

                <span class="c1"># Print progress</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">zarr_folders</span><span class="p">):</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Progress: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">zarr_folders</span><span class="p">)</span><span class="si">}</span><span class="s2"> folders processed&quot;</span><span class="p">)</span>

                <span class="c1"># Report errors</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ScanResult</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create pandas DataFrame from scan results.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        scan_results : List[ScanResult]</span>
<span class="sd">            List of scan results</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            DataFrame with paths and attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Collect all data for DataFrame</span>
        <span class="n">data_rows</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">scan_results</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>  <span class="c1"># Only include successful scans</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">path</span><span class="p">}</span>
                <span class="n">row</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
                <span class="n">data_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_rows</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No valid zarr folders found!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Create DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_rows</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Created database with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> entries and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the current DataFrame to pickle file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database saved to: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load existing database from pickle file.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        bool</span>
<span class="sd">            True if database was loaded successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded existing database from: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s2"> entries&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="MMPP.scan">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.scan">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scan the base directory for zarr folders and create/update the database.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        force : bool, optional</span>
<span class="sd">            If True, force rescan even if database exists (default: False)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The resulting database DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_zarr_mode</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Single zarr mode - no scanning needed.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># Return empty DataFrame for single zarr mode</span>

        <span class="c1"># Check if we need to scan</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Database already loaded. Use force=True to rescan.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span>

        <span class="c1"># Find all zarr folders</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Searching for zarr folders in: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">zarr_folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_zarr_folders</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">zarr_folders</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No zarr folders found!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">zarr_folders</span><span class="p">)</span><span class="si">}</span><span class="s2"> zarr folders&quot;</span><span class="p">)</span>

        <span class="c1"># Scan all folders</span>
        <span class="n">scan_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_all_zarr_folders</span><span class="p">(</span><span class="n">zarr_folders</span><span class="p">)</span>

        <span class="c1"># Create DataFrame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataframe</span><span class="p">(</span><span class="n">scan_results</span><span class="p">)</span>

        <span class="c1"># Save database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_database</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span></div>


<div class="viewcode-block" id="MMPP.force_rescan">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.force_rescan">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">force_rescan</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Force a complete rescan of the directory structure.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The resulting database DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Forcing complete rescan...&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="MMPP.get_parsing_examples">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.get_parsing_examples">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_parsing_examples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zarr_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get examples of how a specific path would be parsed.</span>
<span class="sd">        Useful for debugging path parsing.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        zarr_path : str</span>
<span class="sd">            Path to analyze</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">            Dictionary showing parsing results for each component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">zarr_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span>
        <span class="n">path_parts</span> <span class="o">=</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>

        <span class="n">examples</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;full_path&quot;</span><span class="p">:</span> <span class="n">zarr_path</span><span class="p">,</span>
            <span class="s2">&quot;relative_path&quot;</span><span class="p">:</span> <span class="n">rel_path</span><span class="p">,</span>
            <span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;final_params&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_path_parameters</span><span class="p">(</span><span class="n">zarr_path</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path_parts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zarr&quot;</span><span class="p">):</span>
                <span class="n">clean_part</span> <span class="o">=</span> <span class="n">part</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">examples</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;component_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">part</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;original&quot;</span><span class="p">:</span> <span class="n">part</span><span class="p">,</span>
                    <span class="s2">&quot;cleaned&quot;</span><span class="p">:</span> <span class="n">clean_part</span><span class="p">,</span>
                    <span class="s2">&quot;parsed&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_path_component</span><span class="p">(</span><span class="n">clean_part</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">examples</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;component_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">part</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;original&quot;</span><span class="p">:</span> <span class="n">part</span><span class="p">,</span>
                    <span class="s2">&quot;parsed&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_path_component</span><span class="p">(</span><span class="n">part</span><span class="p">),</span>
                <span class="p">}</span>

        <span class="k">return</span> <span class="n">examples</span></div>


<div class="viewcode-block" id="MMPP.find">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.find">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;PlotterProxy&quot;</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;ZarrJobResult&quot;</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find zarr folders that match the given criteria.</span>
<span class="sd">        Now returns a PlotterProxy with plotting capabilities.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        **kwargs : Any</span>
<span class="sd">            Attribute criteria to match (e.g., PBCx=1, Nx=1296, solver=3)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        PlotterProxy</span>
<span class="sd">            Proxy object containing ZarrJobResult objects with plotting capabilities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_zarr_mode</span><span class="p">:</span>
            <span class="c1"># In single zarr mode, just return the single result if no criteria or if it matches</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="c1"># No criteria, return all (which is just one)</span>
                <span class="k">if</span> <span class="n">PLOTTING_AVAILABLE</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">PlotterProxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Check if single result matches criteria</span>
                <span class="n">matching_results</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">:</span>
                    <span class="n">matches</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">attributes</span>
                            <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">value</span>
                        <span class="p">):</span>
                            <span class="n">matches</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
                        <span class="n">matching_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matching_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results matching criteria: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">PLOTTING_AVAILABLE</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">PlotterProxy</span><span class="p">(</span><span class="n">matching_results</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">matching_results</span>

        <span class="c1"># Original database mode logic</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No database available. Run scan() first.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">PLOTTING_AVAILABLE</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">PlotterProxy</span><span class="p">([],</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Start with all rows</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Apply each filter criterion</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Column &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; not found in database&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Handle different types of comparisons</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="c1"># If value is a list, check if the column value is in the list</span>
                <span class="n">mask</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Direct equality check</span>
                <span class="n">mask</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span>

        <span class="c1"># Get matching rows</span>
        <span class="n">matching_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="c1"># Convert to ZarrJobResult objects</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matching_rows</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">col</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;path&quot;</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="p">}</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ZarrJobResult</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">_set_mmpp_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> folders matching criteria: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">PLOTTING_AVAILABLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PlotterProxy</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="MMPP.find_paths">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.find_paths">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find zarr folder paths that match the given criteria.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        **kwargs : Any</span>
<span class="sd">            Attribute criteria to match (e.g., PBCx=1, Nx=1296)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        List[str]</span>
<span class="sd">            List of paths to zarr folders matching the criteria</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span></div>


<div class="viewcode-block" id="MMPP.find_by_path_param">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.find_by_path_param">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_by_path_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ZarrJobResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find zarr folders that match path-extracted parameters specifically.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        **kwargs : Any</span>
<span class="sd">            Path parameter criteria to match (e.g., solver=3, f0=2.15e+09)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        List[ZarrJobResult]</span>
<span class="sd">            List of ZarrJobResult objects matching the criteria</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No database available. Run scan() first.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Start with all rows</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Apply each filter criterion</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Check both the original parameter name and the _path suffix version</span>
            <span class="n">param_found</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span>
                <span class="n">param_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_path&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_path&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span>
                <span class="n">param_found</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">param_found</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Warning: Parameter &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; not found in database (neither as &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; nor &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_path&#39;)&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>

        <span class="c1"># Get matching rows</span>
        <span class="n">matching_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="c1"># Convert to ZarrJobResult objects</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matching_rows</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">col</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;path&quot;</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="p">}</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ZarrJobResult</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> folders matching path criteria: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="MMPP.find_by_path_param_paths">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.find_by_path_param_paths">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_by_path_param_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find zarr folder paths that match path-extracted parameters specifically.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        **kwargs : Any</span>
<span class="sd">            Path parameter criteria to match (e.g., solver=3, f0=2.15e+09)</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        List[str]</span>
<span class="sd">            List of paths to zarr folders matching the criteria</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_by_path_param</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span></div>


<div class="viewcode-block" id="MMPP.get_job">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.get_job">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ZarrJobResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a specific job by its path.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Path to the zarr folder</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        Optional[ZarrJobResult]</span>
<span class="sd">            ZarrJobResult object or None if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No database available. Run scan() first.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">matching_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">path</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">matching_rows</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No job found with path: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">row</span> <span class="o">=</span> <span class="n">matching_rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">col</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;path&quot;</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ZarrJobResult</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span></div>


<div class="viewcode-block" id="MMPP.get_all_jobs">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.get_all_jobs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ZarrJobResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all jobs as ZarrJobResult objects.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        List[ZarrJobResult]</span>
<span class="sd">            List of all ZarrJobResult objects in the database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No database available. Run scan() first.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">col</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;path&quot;</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="p">}</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ZarrJobResult</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="MMPP.get_database">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.get_database">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current database DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        Optional[pd.DataFrame]</span>
<span class="sd">            The database DataFrame or None if not loaded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span></div>


<div class="viewcode-block" id="MMPP.get_unique_values">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.get_unique_values">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_unique_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get unique values for a specific column.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        column : str</span>
<span class="sd">            Column name</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        List[Any]</span>
<span class="sd">            List of unique values in the column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&#39; not found in database&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span></div>


<div class="viewcode-block" id="MMPP.get_summary">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.get_summary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a summary of the database.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">            Summary information about the database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;No database loaded&quot;</span><span class="p">}</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;total_entries&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">),</span>
            <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
            <span class="s2">&quot;column_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
            <span class="s2">&quot;database_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">summary</span></div>


<div class="viewcode-block" id="MMPP.get_path_parameters">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.get_path_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_path_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zarr_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get parameters extracted from a specific zarr path.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        zarr_path : str</span>
<span class="sd">            Path to the zarr folder</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">            Dictionary of parameters extracted from the path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_path_parameters</span><span class="p">(</span><span class="n">zarr_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="MMPP.get_path_parameter_summary">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.get_path_parameter_summary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_path_parameter_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a summary of all path-extracted parameters and their unique values.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        Dict[str, List[Any]]</span>
<span class="sd">            Dictionary mapping parameter names to lists of unique values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">path_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Find columns that end with &#39;_path&#39; or are likely path parameters</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_path&quot;</span><span class="p">):</span>
                <span class="n">base_name</span> <span class="o">=</span> <span class="n">col</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># Remove &#39;_path&#39; suffix</span>
                <span class="n">unique_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">path_params</span><span class="p">[</span><span class="n">base_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">unique_vals</span>
            <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;solver&quot;</span><span class="p">,</span> <span class="s2">&quot;f0&quot;</span><span class="p">,</span> <span class="s2">&quot;ky&quot;</span><span class="p">,</span> <span class="s2">&quot;maxerr&quot;</span><span class="p">]:</span>  <span class="c1"># Common path parameters</span>
                <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_path&quot;</span><span class="p">)</span>
                <span class="p">]:</span>
                    <span class="n">unique_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="n">path_params</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">unique_vals</span>

        <span class="k">return</span> <span class="n">path_params</span></div>


<div class="viewcode-block" id="MMPP.list_data">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.list_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a formatted list of all data in the database.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        limit : int, optional</span>
<span class="sd">            Maximum number of entries to display (default: 10, use -1 for all)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No database available. Run scan() first.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== MMPP Database Summary ===&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total entries: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total columns: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Show column names</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Columns: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Show sample data</span>
        <span class="n">display_count</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span> <span class="k">if</span> <span class="n">limit</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">min</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== First </span><span class="si">{</span><span class="n">display_count</span><span class="si">}</span><span class="s2"> entries ===&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">display_count</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Entry </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Group parameters by type</span>
            <span class="n">pyzfn_params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">path_params</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;path&quot;</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]):</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_path&quot;</span><span class="p">):</span>
                    <span class="n">path_params</span><span class="p">[</span><span class="n">col</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pyzfn_params</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">pyzfn_params</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pyzfn attributes:&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pyzfn_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">path_params</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Path parameters:&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">path_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">display_count</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">display_count</span><span class="si">}</span><span class="s2"> more entries&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Use list_data(limit=-1) to see all entries&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MMPP.__repr__">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.__repr__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rich representation of MMPP object when printed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_zarr_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;MMPP(single_zarr=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="si">}</span><span class="s2">&#39;, results=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zarr_results</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;MMPP(base_path=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="si">}</span><span class="s2">&#39;, entries=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_interactive_display</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_interactive_display</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate interactive display for the MMPP object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">RICH_AVAILABLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rich_display</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basic_display</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rich_display</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate rich console display.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;[red]No database loaded. Run scan() first.[/red]&quot;</span>

        <span class="c1"># Create summary panel</span>
        <span class="n">summary_text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">()</span>
        <span class="n">summary_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;📊 Total entries: &quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold cyan&quot;</span><span class="p">)</span>
        <span class="n">summary_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bright_white&quot;</span><span class="p">)</span>
        <span class="n">summary_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;📁 Database path: &quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold cyan&quot;</span><span class="p">)</span>
        <span class="n">summary_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">summary_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;🔍 Columns: &quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold cyan&quot;</span><span class="p">)</span>
        <span class="n">summary_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bright_white&quot;</span><span class="p">)</span>

        <span class="c1"># Create methods panel</span>
        <span class="n">methods_text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">()</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;🔧 Available methods:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold yellow&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  • &quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;find(**kwargs)&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; - Search by criteria</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  • &quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;show_interactive()&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; - Interactive table view</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  • &quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;list_data(limit=10)&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; - Formatted list view</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  • &quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;get_summary()&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; - Database summary</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  • &quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;force_rescan()&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
        <span class="n">methods_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; - Rescan directory&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>

        <span class="c1"># Create parameters panel</span>
        <span class="n">param_summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path_parameter_summary</span><span class="p">()</span>
        <span class="n">param_text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">()</span>
        <span class="n">param_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;📋 Key parameters:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold green&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_summary</span><span class="o">.</span><span class="n">items</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]:</span>  <span class="c1"># Show first 5 parameters</span>
            <span class="n">param_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  • </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
            <span class="n">param_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2"> values &quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bright_white&quot;</span><span class="p">)</span>
            <span class="n">param_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="k">if</span> <span class="n">values</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
                    <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="p">[:</span><span class="mi">3</span><span class="p">]))</span><span class="si">}{</span><span class="s1">&#39;...&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">RICH_AVAILABLE</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">capture</span><span class="p">()</span> <span class="k">as</span> <span class="n">capture</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                    <span class="n">Panel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
                        <span class="n">summary_text</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;[bold blue]MMPP Database[/bold blue]&quot;</span><span class="p">,</span>
                        <span class="n">border_style</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                    <span class="n">Columns</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">Panel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
                                <span class="n">methods_text</span><span class="p">,</span>
                                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;[bold yellow]Methods[/bold yellow]&quot;</span><span class="p">,</span>
                                <span class="n">border_style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">Panel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
                                <span class="n">param_text</span><span class="p">,</span>
                                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;[bold green]Parameters[/bold green]&quot;</span><span class="p">,</span>
                                <span class="n">border_style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">capture</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary_text</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">methods_text</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">param_text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_basic_display</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate basic text display.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;MMPP Database: No data loaded. Run scan() first.&quot;</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">MMPP Database Summary:</span>
<span class="s2">=====================</span>
<span class="s2">📊 Total entries: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span>
<span class="s2">📁 Database path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="si">}</span>
<span class="s2">🔍 Columns: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span>

<span class="s2">🔧 Available methods:</span>
<span class="s2">  • find(**kwargs) - Search by criteria</span>
<span class="s2">  • show_interactive() - Interactive table view</span>
<span class="s2">  • list_data(limit=10) - Formatted list view</span>
<span class="s2">  • get_summary() - Database summary</span>
<span class="s2">  • force_rescan() - Rescan directory</span>

<span class="s2">📋 Use &#39;jobs.show_interactive()&#39; for interactive table view</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">summary</span>

<div class="viewcode-block" id="MMPP.show_interactive">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.show_interactive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show_interactive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">400</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show interactive pandas DataFrame viewer.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        max_rows : int, optional</span>
<span class="sd">            Maximum number of rows to display (default: 1000)</span>
<span class="sd">        height : int, optional</span>
<span class="sd">            Height of the table in pixels (default: 400)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No database available. Run scan() first.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">df_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">max_rows</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Try itables first (best option)</span>
        <span class="k">if</span> <span class="n">ITABLES_AVAILABLE</span> <span class="ow">and</span> <span class="n">IPYTHON_AVAILABLE</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Configure itables for VS Code Jupyter</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">itables.options</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">opt</span>

                <span class="n">opt</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                .itables table td { text-align: left; }</span>
<span class="s2">                .itables table th { text-align: left; }</span>
<span class="s2">                &quot;&quot;&quot;</span>

                <span class="c1"># Simplify DataFrame formatting for itables compatibility</span>
                <span class="n">df_formatted</span> <span class="o">=</span> <span class="n">df_display</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="c1"># Format float columns with scientific notation for large numbers</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_formatted</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;path&quot;</span> <span class="ow">and</span> <span class="n">df_formatted</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="s2">&quot;float64&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
                    <span class="p">]:</span>
                        <span class="c1"># Check if column has large numbers</span>
                        <span class="k">if</span> <span class="n">df_formatted</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                            <span class="n">df_formatted</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_formatted</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span>
                            <span class="p">)</span>

                <span class="c1"># Shorten paths for better display</span>
                <span class="k">if</span> <span class="s2">&quot;path&quot;</span> <span class="ow">in</span> <span class="n">df_formatted</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">df_formatted</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_formatted</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                            <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="c1"># Use itables with simplified parameters for VS Code</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">itables</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_html_datatable</span>

                <span class="n">html_table</span> <span class="o">=</span> <span class="n">to_html_datatable</span><span class="p">(</span>
                    <span class="n">df_formatted</span><span class="p">,</span>
                    <span class="n">maxHeight</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                    <span class="n">scrollX</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">scrollY</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">classes</span><span class="o">=</span><span class="s2">&quot;display compact stripe hover&quot;</span><span class="p">,</span>
                    <span class="n">table_id</span><span class="o">=</span><span class="s2">&quot;mmpp_table&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html_table</span><span class="p">))</span>
                <span class="k">return</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;itables failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, falling back to rich display&quot;</span><span class="p">)</span>

        <span class="c1"># Try rich table display</span>
        <span class="k">if</span> <span class="n">RICH_AVAILABLE</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_show_rich_table</span><span class="p">(</span><span class="n">df_display</span><span class="p">,</span> <span class="n">max_rows</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>  <span class="c1"># Limit for rich display</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rich display failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, falling back to pandas&quot;</span><span class="p">)</span>

        <span class="c1"># Fallback to pandas display with VS Code optimization</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create a nicely formatted HTML table for VS Code</span>
            <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_styled_html_table</span><span class="p">(</span><span class="n">df_display</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">IPYTHON_AVAILABLE</span><span class="p">:</span>
                <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HTML table created but cannot display in this environment&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTML display failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, using basic pandas display&quot;</span><span class="p">)</span>
            <span class="c1"># Basic pandas display</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_columns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.width&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">df_display</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">max_rows</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_show_rich_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">max_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show DataFrame using rich table.&quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;MMPP Database&quot;</span><span class="p">,</span> <span class="n">show_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header_style</span><span class="o">=</span><span class="s2">&quot;bold magenta&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Add columns</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;path&quot;</span><span class="p">:</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_path&quot;</span><span class="p">):</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;solver&quot;</span><span class="p">,</span> <span class="s2">&quot;f0&quot;</span><span class="p">,</span> <span class="s2">&quot;ky&quot;</span><span class="p">,</span> <span class="s2">&quot;maxerr&quot;</span><span class="p">]:</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

        <span class="c1"># Add rows</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">max_rows</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
            <span class="n">row_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;[dim]N/A[/dim]&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;path&quot;</span><span class="p">:</span>
                    <span class="c1"># Shorten path for display</span>
                    <span class="n">short_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">)</span>
                    <span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim]</span><span class="si">{</span><span class="n">short_path</span><span class="si">}</span><span class="s2">[/dim]&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                    <span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="o">*</span><span class="n">row_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_rows</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;[dim]... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">max_rows</span><span class="si">}</span><span class="s2"> more rows[/dim]&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_styled_html_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create styled HTML table.&quot;&quot;&quot;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;style&gt;</span>
<span class="s2">        .mmpp-table {</span>
<span class="s2">            border-collapse: collapse;</span>
<span class="s2">            width: 100%;</span>
<span class="s2">            font-family: Arial, sans-serif;</span>
<span class="s2">            font-size: 12px;</span>
<span class="s2">        }</span>
<span class="s2">        .mmpp-table th, .mmpp-table td {</span>
<span class="s2">            border: 1px solid #ddd;</span>
<span class="s2">            padding: 8px;</span>
<span class="s2">            text-align: left;</span>
<span class="s2">        }</span>
<span class="s2">        .mmpp-table th {</span>
<span class="s2">            background-color: #4CAF50;</span>
<span class="s2">            color: white;</span>
<span class="s2">            font-weight: bold;</span>
<span class="s2">        }</span>
<span class="s2">        .mmpp-table .path-col {</span>
<span class="s2">            background-color: #f0f8ff;</span>
<span class="s2">            font-family: monospace;</span>
<span class="s2">            font-size: 10px;</span>
<span class="s2">            max-width: 300px;</span>
<span class="s2">            overflow: hidden;</span>
<span class="s2">            text-overflow: ellipsis;</span>
<span class="s2">        }</span>
<span class="s2">        .mmpp-table .path-param {</span>
<span class="s2">            background-color: #fff3cd;</span>
<span class="s2">        }</span>
<span class="s2">        .mmpp-table .key-param {</span>
<span class="s2">            background-color: #d4edda;</span>
<span class="s2">        }</span>
<span class="s2">        .mmpp-table tr:nth-child(even) {</span>
<span class="s2">            background-color: #f9f9f9;</span>
<span class="s2">        }</span>
<span class="s2">        .mmpp-table tr:hover {</span>
<span class="s2">            background-color: #f5f5f5;</span>
<span class="s2">        }</span>
<span class="s2">        &lt;/style&gt;</span>
<span class="s2">        &lt;table class=&quot;mmpp-table&quot;&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="c1"># Header</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;tr&gt;&quot;</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;th&gt;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&lt;/th&gt;&quot;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/tr&gt;&quot;</span>

        <span class="c1"># Rows</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>  <span class="c1"># Limit for HTML</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;tr&gt;&quot;</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="n">css_class</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;path&quot;</span><span class="p">:</span>
                    <span class="n">css_class</span> <span class="o">=</span> <span class="s2">&quot;path-col&quot;</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_path&quot;</span><span class="p">):</span>
                    <span class="n">css_class</span> <span class="o">=</span> <span class="s2">&quot;path-param&quot;</span>
                <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;solver&quot;</span><span class="p">,</span> <span class="s2">&quot;f0&quot;</span><span class="p">,</span> <span class="s2">&quot;ky&quot;</span><span class="p">,</span> <span class="s2">&quot;maxerr&quot;</span><span class="p">]:</span>
                    <span class="n">css_class</span> <span class="o">=</span> <span class="s2">&quot;key-param&quot;</span>

                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;td class=&quot;</span><span class="si">{</span><span class="n">css_class</span><span class="si">}</span><span class="s1">&quot;&gt;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&lt;/td&gt;&#39;</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/tr&gt;&quot;</span>

        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/table&gt;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;&lt;i&gt;... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s2"> more rows. Use show_interactive() with itables for full view.&lt;/i&gt;&lt;/p&gt;&quot;</span>

        <span class="k">return</span> <span class="n">html</span>

<div class="viewcode-block" id="MMPP.set_interactive_mode">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.set_interactive_mode">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_interactive_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable or disable interactive display mode.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        enabled : bool, optional</span>
<span class="sd">            Whether to enable interactive mode (default: True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_mode</span> <span class="o">=</span> <span class="n">enabled</span>
        <span class="k">if</span> <span class="n">enabled</span> <span class="ow">and</span> <span class="n">RICH_AVAILABLE</span><span class="p">:</span>
            <span class="n">rprint</span><span class="p">(</span><span class="s2">&quot;[green]✓[/green] Interactive mode enabled&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Interactive mode enabled (basic)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interactive mode disabled&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MMPP.install_display_deps">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.MMPP.install_display_deps">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">install_display_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print installation instructions for interactive display dependencies.&quot;&quot;&quot;</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ITABLES_AVAILABLE</span><span class="p">:</span>
            <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;itables&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">RICH_AVAILABLE</span><span class="p">:</span>
            <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;rich&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">IPYTHON_AVAILABLE</span><span class="p">:</span>
            <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ipython&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To enable full interactive features, install:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pip install </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ All interactive display dependencies available!&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="mmpp">
<a class="viewcode-back" href="../../api/core.html#mmpp.core.mmpp">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mmpp</span><span class="p">(</span><span class="n">base_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MMPP</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience function to create and initialize a MMPP.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    base_path : str</span>
<span class="sd">        Base directory path to scan</span>
<span class="sd">    force : bool, optional</span>
<span class="sd">        If True, force rescan even if database exists (default: False)</span>
<span class="sd">    **kwargs : Any</span>
<span class="sd">        Additional arguments passed to MMPP constructor</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    MMPP</span>
<span class="sd">        Initialized processor instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">MMPP</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">processor</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">processor</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Mateusz Zelent.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>